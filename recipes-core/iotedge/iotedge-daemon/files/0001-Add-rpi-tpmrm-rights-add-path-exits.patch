From 33caf0597801c56d67b12d4b4d475c6ebd13f315 Mon Sep 17 00:00:00 2001
From: Joerg Zeidler <joerg.zeidler@conplement.de>
Date: Tue, 9 Feb 2021 15:47:00 +0000
Subject: [PATCH] service depends on rpi-tpmrm-rights; add path exits check

---
 edgelet/contrib/systemd/debian/iotedge.service | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/edgelet/contrib/systemd/debian/iotedge.service b/edgelet/contrib/systemd/debian/iotedge.service
index 6cbbbe7..786a48f 100644
--- a/edgelet/contrib/systemd/debian/iotedge.service
+++ b/edgelet/contrib/systemd/debian/iotedge.service
@@ -1,9 +1,10 @@
 [Unit]
 Description=Azure IoT Edge daemon
-After=network-online.target docker.service iotedge.socket iotedge.mgmt.socket
-Requires=iotedge.socket iotedge.mgmt.socket
+After=network-online.target docker.service iotedge.socket iotedge.mgmt.socket rpi-tpmrm-rights.service
+Requires=iotedge.socket iotedge.mgmt.socket rpi-tpmrm-rights.service
 Wants=network-online.target docker.service
 Documentation=man:iotedged(8)
+ConditionPathExists=/etc/ics_dm/enrolled
 
 [Service]
 ExecStart=/usr/bin/iotedged -c /etc/iotedge/config.yaml
-- 
2.20.1

