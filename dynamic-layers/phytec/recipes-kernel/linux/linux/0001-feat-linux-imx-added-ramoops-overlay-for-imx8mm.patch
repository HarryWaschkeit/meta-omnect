From 22169e4884ffc37c6e801fc7dc4db86dce3ae8ba Mon Sep 17 00:00:00 2001
From: kas User <kas@example.com>
Date: Tue, 11 Feb 2025 08:52:14 +0000
Subject: [PATCH 1/1] feat(linux-imx): added ramoops overlay for imx8mm

Signed-off-by: kas User <kas@example.com>
---
 .../boot/dts/freescale/overlays/Makefile      |  1 +
 .../freescale/overlays/imx8mm-ramoops.dtso    | 31 +++++++++++++++++++
 2 files changed, 32 insertions(+)
 create mode 100644 arch/arm64/boot/dts/freescale/overlays/imx8mm-ramoops.dtso

diff --git a/arch/arm64/boot/dts/freescale/overlays/Makefile b/arch/arm64/boot/dts/freescale/overlays/Makefile
index 0f230aa1c..4e063c1bd 100644
--- a/arch/arm64/boot/dts/freescale/overlays/Makefile
+++ b/arch/arm64/boot/dts/freescale/overlays/Makefile
@@ -24,6 +24,7 @@ dtb-y += imx8mm-vm017-fpdlink-port1.dtbo
 dtb-y += imx8mm-vm020.dtbo
 dtb-y += imx8mm-vm020-fpdlink-port0.dtbo
 dtb-y += imx8mm-vm020-fpdlink-port1.dtbo
+dtb-y += imx8mm-ramoops.dtbo
 dtb-y += imx8mn-phyboard-polis-peb-eval-01.dtbo
 dtb-y += imx8mn-phycore-no-spiflash.dtbo
 dtb-y += imx8mn-phycore-no-eth.dtbo
diff --git a/arch/arm64/boot/dts/freescale/overlays/imx8mm-ramoops.dtso b/arch/arm64/boot/dts/freescale/overlays/imx8mm-ramoops.dtso
new file mode 100644
index 000000000..d234d0f87
--- /dev/null
+++ b/arch/arm64/boot/dts/freescale/overlays/imx8mm-ramoops.dtso
@@ -0,0 +1,31 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	compatible = "phytec,imx8mm-phycore-som";
+
+	fragment@0 {
+		target = <&resmem>;
+		__overlay__ {
+			ramoops: ramoops@b0000000 {
+				compatible = "ramoops";
+				reg = <0x0 0x0b0000000 0x0 0x40000>; /*	   256kB */
+				record-size = <0x1000>;              /*	     4kB */
+				console-size = <0x10000>;            /*	     64k */
+				ecc-size = <1>;                      /*  enabled */
+				pmsg-size = <0x4000>;                /*     16kB */
+				ftrace-size = <0>;                   /* disabled */
+			};
+		};
+	};
+
+	__overrides__ {
+		base-addr = <&ramoops>,"reg#0";
+		total-size = <&ramoops>,"reg:8";
+		record-size = <&ramoops>,"record-size:0";
+		console-size = <&ramoops>,"console-size:0";
+		ecc-size = <&ramoops>,"ecc-size:0";
+		pmsg-size = <&ramoops>,"pmsg-size:0";
+		ftrace-size = <&ramoops>,"ftrace-size:0";
+	};
+};
-- 
2.39.5

