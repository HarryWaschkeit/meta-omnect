require conf/machine/include/karo-tx6s.inc

# we have an mx6dl here which is a cortexa9, and use hard float abi and neon
# math copro
DEFAULTTUNE:tx6s-8035 ?= "cortexa9thf-neon"

# needed for firmware files provided by package imx-firmware
MACHINEOVERRIDES:append = ":imx-generic-bsp:imx-mainline-bsp"

# adu compatibility id
ADU_DEVICEPROPERTIES_COMPATIBILITY_ID = "2"

# remove machine features the hardware doesn't provide per se
MACHINE_FEATURES:remove = " \
    3g \
    alsa \
    bluetooth \
    touchscreen \
    wifi \
"

# remove distro features we don't support
DISTRO_FEATURES:remove = " \
    3g \
    alsa \
    bluetooth \
    nfc \
    opengl \
    pulseaudio \
    x11 \
    vulkan \
    wayland \
    wifi \
"

#DISTRO_FEATURES:append = " flash-mode-2 persistent-var-log"
DISTRO_FEATURES:append = " flash-mode-2"

## rm dtbos from boot partition (we install them in root)
#IMAGE_BOOT_FILES:remove:pn-omnect-os-image = " \
#    imx8mm-phygate-tauri-rs232-rs232.dtbo \
#    imx8mm-phygate-tauri-rs232-rs485.dtbo \
#    imx8mm-phygate-tauri-rs232-rs485-switchable.dtbo \
#    imx8mm-phygate-tauri-rs232-rts-cts.dtbo \
#    imx8mm-phycore-rpmsg.dtbo \
#    imx8mm-phycore-no-eth.dtbo \
#    imx8mm-phycore-no-spiflash.dtbo \
#"

# FIXME: double check if UBOOT_FDT_LOAD could also be used for actual
# u-boot-karo build due to proprietary device tree handling by karo code.
UBOOT_FDT_LOAD:pn-omnect-os-image = "1"
UBOOT_FDT_LOAD:pn-u-boot-scr = "1"
UBOOT_FDT_ADDR:pn-u-boot-scr = "fdt_addr"

## u-boot boot.scr config
KERNEL_DEVICETREE_FN = "imx6dl-tx6s-8035.dtb"

## extra devicetree files for tests
KERNEL_DEVICETREE += " \
	imx6dl-tx6u-8033.dtb \
	imx6dl-tx6u-8033-mb7.dtb \
"


OMNECT_WAIT_ONLINE_INTERFACES_BUILD = "eth0"

## TODO clarify with upstream
## this is not set in meta-phytec, copied it from meta-phytec polis config
#ATF_PLATFORM = "imx8mm"
#ATF_LOAD_ADDR = "0x920000"

# no differentiation for now between release an devel images concerning rootfs
# size
OMNECT_PART_SIZE_ROOTFS ?= "${@bb.utils.contains('OMNECT_RELEASE_IMAGE', '1', '563200', '563200', d)}"
OMNECT_PART_SIZE_BOOT = "61440"

BOOTLOADER_SEEK:tx6s-8035 ?= "1"

#PREFERRED_PROVIDER_virtual/kernel = "linux-imx"
#PREFERRED_VERSION_linux-karo = "5.10"